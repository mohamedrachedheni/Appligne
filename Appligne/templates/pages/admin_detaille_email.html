<!-- admin_detaille_email.html -->
{% extends 'base.html' %}
{% load static %}
{% block title %} | Détails des demandes de cours reçues{% endblock %}

{% block content %}

<!-- mon compte début -->
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-sm-12 col-md-4 col-lg-2">
            <!-- début sidebar -->
            {% if request.user.is_authenticated %}
                {% if request.user.eleve %}
                    {% include 'partials/_sidebar_eleve.html' %}
                {% elif request.user.professeur %}
                    {% include 'partials/_sidebar.html' %}
                {% elif request.user.is_staff and request.user.is_active %}
                    {% include 'partials/_sidebar_admin.html' %}
                {% endif %}
            {% endif %}
            <!-- fin sidebar -->
        </div>
        
        <div class="col-sm-12 col-md-8 col-lg-10 wow fadeInUp" data-wow-delay="0.1s">
            <div class="container-fluid py-3">
                <div class="row">
                    <div class="col-12">
                        {% include 'partials/_alerts.html' %}
                    </div>
                </div>
                
                <!-- En-tête de page -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h4 class="mb-0 text-primary">
                                <i class="fas fa-envelope me-2"></i>Détails de l'email
                            </h4>
                            <nav aria-label="breadcrumb">
                                <ol class="breadcrumb mb-0">
                                    <li class="breadcrumb-item"><a href="{% url 'index' %}">Accueil</a></li>
                                    <li class="breadcrumb-item"><a href="{% url 'admin_liste_email_recu' %}">Emails reçus</a></li>
                                    <li class="breadcrumb-item active" aria-current="page">Détails</li>
                                </ol>
                            </nav>
                        </div>
                        <hr class="mt-2">
                    </div>
                </div>

                <!-- Début Form-->
                <form method="POST" enctype="multipart/form-data" autocomplete="off">
                    {% csrf_token %}
                    
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-primary text-white py-3">
                            <h5 class="card-title mb-0">
                                <i class="fas fa-info-circle me-2"></i>Informations sur l'email
                            </h5>
                        </div>
                        
                        <div class="card-body">
                            <div class="row g-4">
                                <div class="col-md-6 position-relative">
                                    <label for="date_expedition_id" class="form-label fw-semibold">
                                        <i class="fas fa-calendar-alt me-1 text-primary"></i>Date d'expédition
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-clock text-muted"></i></span>
                                        <input type="text" class="form-control bg-light" id="date_expedition_id" 
                                               name="date_expedition" value="{{email.date_telechargement|date:'d/m/Y à H:i'}}" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-md-6 position-relative">
                                    <label for="expediteur_id" class="form-label fw-semibold">
                                        <i class="fas fa-user me-1 text-primary"></i>Expéditeur
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-user text-muted"></i></span>
                                        <input type="text" class="form-control bg-light" id="expediteur_id" 
                                               name="expediteur" value="{{email.user.first_name}} {{email.user.last_name}}" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-12 position-relative">
                                    <label for="sujet_id" class="form-label fw-semibold">
                                        <i class="fas fa-tag me-1 text-primary"></i>Sujet de l'email
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-tag text-muted"></i></span>
                                        <input type="text" class="form-control bg-light" id="sujet_id" 
                                               name="sujet" value="{{email.sujet}}" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-12 position-relative">
                                    <label for="source_id" class="form-label fw-semibold">
                                        <i class="fas fa-envelope me-1 text-primary"></i>Email de l'expéditeur
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text bg-light"><i class="fas fa-at text-muted"></i></span>
                                        <input type="text" class="form-control bg-light" id="source_id" 
                                               name="source" value="{{email.email_telecharge}}" readonly>
                                    </div>
                                </div>
                                
                                <div class="col-12 position-relative">
                                    <label for="text_email_id" class="form-label fw-semibold">
                                        <i class="fas fa-align-left me-1 text-primary"></i>Contenu de l'email reçu
                                    </label>
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <textarea class="form-control border-0 bg-transparent profil" 
                                                      id="text_email_id" rows="6" name="text_email" 
                                                      placeholder="Contenu de l'email..." readonly>{{email.text_email}}</textarea>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-12 mt-4">
                                    <div class="d-flex flex-wrap justify-content-center gap-3">
                                        <button type="submit" class="btn btn-action btn-ignore" name="btn_ignorer" 
                                                {% if not email.user.professeur and not email.user.eleve %}disabled{% endif %}>
                                            <i class="fas fa-times-circle me-2"></i>Ignorer
                                        </button>
                                        
                                        <button type="submit" class="btn btn-action btn-confirm" name="btn_confirmer" 
                                                {% if not email.user.professeur and not email.user.eleve %}disabled{% endif %}>
                                            <i class="fas fa-check-circle me-2"></i>Bien reçu
                                        </button>
                                        
                                        <button type="submit" class="btn btn-action btn-reply" name="btn_repondre_email_{{email_id}}" 
                                                {% if not email.user.professeur and not email.user.eleve %}disabled{% endif %}>
                                            <i class="fas fa-reply me-2"></i>Répondre
                                        </button>
                                        
                                        <button type="submit" class="btn btn-action btn-history" name="btn_historique" 
                                                {% if not email.reponse_email_id and email.user != request.user %}disabled{% endif %}>
                                            <i class="fas fa-history me-2"></i>Voir réponse
                                        </button>
                                        
                                        <a class="btn btn-action btn-view" 
                                           name="btn_détaille_{{ email.id }}"
                                           {% if email.user.professeur %}
                                               href="{% url 'admin_compte_prof' user_id=email.user.id %}"
                                           {% elif email.user.eleve %}
                                               href="{% url 'admin_compte_eleve' user_id=email.user.id %}"
                                           {% else %}
                                               href="#"
                                           {% endif %}
                                           {% if not email.user.professeur and not email.user.eleve %}disabled{% endif %}>
                                            <i class="fas fa-eye me-2"></i>Voir expéditeur
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <!-- Fin Form -->
            </div>
        </div>
    </div>
</div>
<!-- mon compte fin -->

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
{% endblock %}

{% block javascript %}
<style>
    .btn-action {
        min-width: 160px;
        padding: 10px 15px;
        font-weight: 500;
        border-radius: 8px;
        transition: all 0.3s ease;
    }
    
    .btn-ignore {
        background-color: #ffc107;
        border-color: #ffc107;
        color: #212529;
    }
    
    .btn-ignore:hover:not(:disabled) {
        background-color: #e0a800;
        border-color: #e0a800;
        color: #212529;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .btn-confirm {
        background-color: #198754;
        border-color: #198754;
        color: white;
    }
    
    .btn-confirm:hover:not(:disabled) {
        background-color: #157347;
        border-color: #157347;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .btn-reply, .btn-history, .btn-view {
        background-color: #0d6efd;
        border-color: #0d6efd;
        color: white;
    }
    
    .btn-reply:hover:not(:disabled), 
    .btn-history:hover:not(:disabled), 
    .btn-view:hover:not(:disabled) {
        background-color: #0b5ed7;
        border-color: #0b5ed7;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    .card {
        border-radius: 12px;
        overflow: hidden;
    }
    
    .form-label {
        margin-bottom: 0.5rem;
        font-size: 0.9rem;
    }
    
    .input-group-text {
        border-right: none;
    }
    
    .bg-light {
        background-color: #f8f9fa !important;
    }
    
    @media (max-width: 768px) {
        .btn-action {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .d-flex.justify-content-center.gap-3 {
            flex-direction: column;
            gap: 10px !important;
        }
    }
</style>

<script>
    // Fonction pour redimensionner les Textarea selon leur contenu
    function adjustTextareaHeight() {
        const textareas = document.getElementsByClassName('form-control profil');
        
        for (let i = 0; i < textareas.length; i++) {
            const textarea = textareas[i];
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }
    }
    
    // Appel lors du chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
        adjustTextareaHeight();
        
        // Ajouter des tooltips aux boutons désactivés
        const disabledButtons = document.querySelectorAll('button:disabled, a.btn:disabled');
        disabledButtons.forEach(button => {
            button.title = "Action non disponible";
        });
    });
    
    // Appel sur changement de contenu
    document.addEventListener('input', adjustTextareaHeight);
</script>
{% endblock %}