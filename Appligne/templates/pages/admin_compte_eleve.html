{% extends 'base.html' %}
{% load static %}
{% block title %} | Consultation compte élève{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-sm-12 col-md-4 col-lg-2  ">
        <!-- début sidebar -->
        {% include 'partials/_sidebar_admin.html' %}
        <!-- fin sidebar -->
    </div>
    <div class=" col-sm-12 col-md-8 col-lg-10  wow fadeInUp  " data-wow-delay="0.1s">
        <!-- En-tête de page -->
        <div class="container-xxl py-3">
            <!-- <div class="container"> -->
                <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                    <h6 class="section-title bg-white text-center text-primary px-3">Consultation compte élève</h6>
                    <h1 class="mb-4">Détails par table</h1>
                    <p class="text-muted">Consultez et modifiez les informations détaillées de l'élève</p>
                </div>
                <div class="col-md-12">
                    {% include 'partials/_alerts.html' %}
                </div>
            <!-- </div> -->
        </div>

        <form method="POST" enctype="multipart/form-data" id="eleveForm">
            {% csrf_token %}
            {% if request.user.is_authenticated and request.user.is_staff and request.user.is_active %}
            
            <!-- Navigation par onglets -->
            <div class="container-xxl mb-4">
                <!-- <div class="container"> -->
                    <ul class="nav nav-tabs" id="eleveTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="auth-user-tab" data-bs-toggle="tab" data-bs-target="#auth-user" type="button" role="tab">
                                <i class="fas fa-user me-2"></i>Auth User
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="eleve-tab" data-bs-toggle="tab" data-bs-target="#eleve" type="button" role="tab">
                                <i class="fas fa-graduation-cap me-2"></i>Élève
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="parent-tab" data-bs-toggle="tab" data-bs-target="#parent" type="button" role="tab">
                                <i class="fas fa-users me-2"></i>Parent
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="temoignages-tab" data-bs-toggle="tab" data-bs-target="#temoignages" type="button" role="tab">
                                <i class="fas fa-comments me-2"></i>Témoignages
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button" role="tab">
                                <i class="fas fa-envelope me-2"></i>Email
                            </button>
                        </li>
                    </ul>
                <!-- </div> -->
            </div>

            <!-- Contenu des onglets -->
            <div class="tab-content" id="eleveTabContent">
                
                <!-- Sélection de l'élève -->
                {% if user_id == 0 %}
                <div class="container-xxl mb-4">
                    <!-- <div class="container"> -->
                        <div class="card shadow-sm">
                            <div class="card-header bg-light">
                                <h5 class="mb-0"><i class="fas fa-search me-2"></i>Sélectionner un élève</h5>
                            </div>
                            <div class="card-body">
                                <div class="row g-3">
                                    <div class="col-lg-6 position-relative">
                                        <label class="form-label fw-bold" for="professeurs">Rechercher un élève</label>
                                        <div class="input-group">
                                            <span class="input-group-text"><i class="fas fa-user-graduate"></i></span>
                                            <input type="text" class="form-control form-control-autre" id="eleveSearch" 
                                                name="professeurs" value="{{ user_eleve_select.first_name }} {{ user_eleve_select.last_name }}"
                                                placeholder="Nom, prénom ou ID de l'élève...">
                                            <input type="hidden" id="selected_eleve" name="user_prof_select_id" value="{{ user_eleve_select.id }}">
                                        </div>
                                        <div class="form-text">Commencez à taper pour rechercher un élève</div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="search-results-container mt-4" id="searchResults" style="display: none;">
                                            <div class="list-group" id="eleveResults">
                                                {% for eleve in user_eleves %}
                                                <a href="#" class="list-group-item list-group-item-action eleve-item" 
                                                    data-id="{{ eleve.id }}" data-value="{{ eleve.first_name }} {{ eleve.last_name }}">
                                                    <div class="d-flex w-100 justify-content-between">
                                                        <h6 class="mb-1">{{ eleve.first_name }} {{ eleve.last_name }}</h6>
                                                        <small>ID: {{ eleve.id }}</small>
                                                    </div>
                                                    <small class="text-muted">{{ eleve.email }}</small>
                                                </a>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    <!-- </div> -->
                </div>
                {% endif %}

                <!-- Onglet 1: Table auth_user -->
                <div class="tab-pane fade show active" id="auth-user" role="tabpanel">
                    <div class="container-xxl">
                        <!-- <div class="container"> -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-light d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0"><i class="fas fa-database me-2"></i>Table auth_user</h5>
                                    <span class="badge bg-primary">Informations de connexion</span>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6 col-lg-4">
                                            <label for="username_id" class="form-label fw-bold">Nom d'utilisateur</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-at"></i></span>
                                                <input type="text" class="form-control" id="username_id" name="username" required
                                                    value="{{ user_eleve_select.username }}" autocomplete="off">
                                            </div>
                                            <div class="form-text">Identifiant unique pour la connexion</div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="first_name_id" class="form-label fw-bold">Prénom</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-signature"></i></span>
                                                <input type="text" class="form-control" id="first_name_id" name="first_name" required 
                                                    value="{{ user_eleve_select.first_name|default:'' }}" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="last_name_id" class="form-label fw-bold">Nom</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-signature"></i></span>
                                                <input type="text" class="form-control" id="last_name_id" name="last_name" required 
                                                    value="{{ user_eleve_select.last_name|default:'' }}">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="email_id" class="form-label fw-bold">Email</label>
                                            <div class="input-group">
                                                <span class="input-group-text">@</span>
                                                <input type="email" class="form-control" id="email_id" name="email" required 
                                                    value="{{ user_eleve_select.email|default:'' }}" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="last_login_id" class="form-label fw-bold">Dernière connexion</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-clock"></i></span>
                                                <input type="text" class="form-control" id="last_login_id" 
                                                    value="{{ user_eleve_select.last_login|date:'d/m/Y H:i' }}" disabled>
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="date_joined_id" class="form-label fw-bold">Date d'inscription</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-calendar-alt"></i></span>
                                                <input type="text" class="form-control" id="date_joined_id" 
                                                    value="{{ user_eleve_select.date_joined|date:'d/m/Y' }}" disabled>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="form-check form-switch">
                                                <input class="form-check-input check-pricipal" type="checkbox" id="is_active" 
                                                    name="is_active" {% if user_eleve_select.is_active %} checked {% endif %}>
                                                <label class="form-check-label fw-bold" for="is_active">
                                                    Compte actif
                                                </label>
                                                <div class="form-text">Un compte désactivé ne peut plus accéder au système</div>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-warning" name="btn_enr_user_eleve">
                                                    <i class="fas fa-save me-2"></i>Enregistrer
                                                </button>
                                                <button type="submit" class="btn btn-outline-secondary" name="btn_fermer">
                                                    <i class="fas fa-times me-2"></i>Fermer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- </div> -->
                    </div>
                </div>

                <!-- Onglet 2: Table eleves_eleve -->
                <div class="tab-pane fade" id="eleve" role="tabpanel">
                    <div class="container-xxl">
                        <!-- <div class="container"> -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0"><i class="fas fa-database me-2"></i>Table eleves_eleve</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6 col-lg-4">
                                            <label for="civilite_id" class="form-label fw-bold">Civilité</label>
                                            <select class="form-select" id="civilite_id" name="civilite">
                                                <option value="Homme" {% if user_eleve_select.eleve.civilite == 'Homme' %}selected{% endif %}>Monsieur</option>
                                                <option value="Femme" {% if user_eleve_select.eleve.civilite == 'Femme' %}selected{% endif %}>Madame</option>
                                                <option value="Autre" {% if user_eleve_select.eleve.civilite == 'Autre' %}selected{% endif %}>Autre</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label class="form-label fw-bold" for="numero_telephone_id">Téléphone</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                                <input type="text" class="form-control form-control-telephone" id="numero_telephone_id" 
                                                    name="phone" placeholder="00 00 00 00 00"
                                                    value="{{ user_eleve_select.eleve.numero_telephone|default:'' }}">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="date_id_1" class="form-label fw-bold">Date de naissance</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-birthday-cake"></i></span>
                                                <input type="text" class="form-control form-control-date" id="date_id_1" 
                                                    name="date_naissance" value="{{ user_eleve_select.eleve.date_naissance|date:'d/m/Y' }}">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label for="adresse_id" class="form-label fw-bold">Adresse</label>
                                            <textarea class="form-control" id="adresse_id" name="adresse" 
                                                rows="2">{{ user_eleve_select.eleve.adresse|default:'' }}</textarea>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-warning" name="btn_enr_eleve">
                                                    <i class="fas fa-save me-2"></i>Enregistrer
                                                </button>
                                                <button type="submit" class="btn btn-outline-secondary" name="btn_fermer">
                                                    <i class="fas fa-times me-2"></i>Fermer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- </div> -->
                    </div>
                </div>

                <!-- Onglet 3: Table eleves_parent -->
                <div class="tab-pane fade" id="parent" role="tabpanel">
                    <div class="container-xxl">
                        <!-- <div class="container"> -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0"><i class="fas fa-database me-2"></i>Table eleves_parent</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6 col-lg-4">
                                            <label for="prenom_parent_id" class="form-label fw-bold">Prénom du parent</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-signature"></i></span>
                                                <input type="text" class="form-control" id="prenom_parent_id" name="prenom_parent"  
                                                    value="{{ user_eleve_select.parent.prenom_parent|default:'' }}" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="nom_parent_id" class="form-label fw-bold">Nom du parent</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-signature"></i></span>
                                                <input type="text" class="form-control" id="nom_parent_id" name="nom_parent"  
                                                    value="{{ user_eleve_select.parent.nom_parent|default:'' }}">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="civilite_parent_id" class="form-label fw-bold">Civilité</label>
                                            <select class="form-select" id="civilite_parent_id" name="civilite_parent">
                                                <option value="Homme" {% if user_eleve_select.parent.civilite == 'Homme' %}selected{% endif %}>Monsieur</option>
                                                <option value="Femme" {% if user_eleve_select.parent.civilite == 'Femme' %}selected{% endif %}>Madame</option>
                                                <option value="Autre" {% if user_eleve_select.parent.civilite == 'Autre' %}selected{% endif %}>Autre</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label for="email_parent_id" class="form-label fw-bold">Email</label>
                                            <div class="input-group">
                                                <span class="input-group-text">@</span>
                                                <input type="text" class="form-control" id="email_parent_id" name="email_parent"  
                                                    value="{{ user_eleve_select.parent.email_parent|default:'' }}" autocomplete="off">
                                            </div>
                                        </div>
                                        <div class="col-md-6 col-lg-4">
                                            <label class="form-label fw-bold" for="telephone_parent_id">Téléphone</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-phone"></i></span>
                                                <input type="text" class="form-control form-control-telephone" id="telephone_parent_id" name="telephone_parent"
                                                    placeholder="00 00 00 00 00"
                                                    value="{{ user_eleve_select.parent.telephone_parent|default:'' }}">
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-warning" name="btn_enr_eleve_parent">
                                                    <i class="fas fa-save me-2"></i>Enregistrer
                                                </button>
                                                <button type="submit" class="btn btn-outline-secondary" name="btn_fermer">
                                                    <i class="fas fa-times me-2"></i>Fermer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- </div> -->
                    </div>
                </div>

                <!-- Onglet 4: Table eleve_temoignage -->
                <div class="tab-pane fade" id="temoignages" role="tabpanel">
                    <div class="container-xxl">
                        <!-- <div class="container"> -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0"><i class="fas fa-database me-2"></i>Table eleve_temoignage</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3" style="max-height: 400px; overflow-y: auto;">
                                        {% if temoignages %}
                                            {% for temoignage in temoignages %}
                                            <div class="col-12 mb-3">
                                                <div class="card testimonial-card">
                                                    <div class="card-header d-flex justify-content-between align-items-center">
                                                        <span class="badge bg-{% if temoignage.evaluation_eleve == 'Excellent' %}success{% elif temoignage.evaluation_eleve == 'Bon' %}info{% elif temoignage.evaluation_eleve == 'Moyen' %}warning{% else %}secondary{% endif %}">
                                                            {{ temoignage.get_evaluation_eleve_display }}
                                                        </span>
                                                        <small class="text-muted">{{ temoignage.date_creation|date:"d/m/Y" }}</small>
                                                    </div>
                                                    <div class="card-body">
                                                        <div class="row">
                                                            <div class="col-md-6">
                                                                <h6 class="card-subtitle mb-2 text-muted">Témoignage de l'élève:</h6>
                                                                <p class="card-text">{{ temoignage.text_eleve|default:"Aucun témoignage" }}</p>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <h6 class="card-subtitle mb-2 text-muted">Retour du professeur:</h6>
                                                                <p class="card-text">{{ temoignage.text_prof|default:"Aucun retour" }}</p>
                                                                <small class="text-muted">- {{ temoignage.user_prof.professeur.user.first_name }} {{ temoignage.user_prof.professeur.user.last_name }}</small>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            {% endfor %}
                                            <div class="col-12 mt-4">
                                                <div class="d-flex gap-2">
                                                    <button type="submit" class="btn btn-warning" name="btn_enr_temoignage">
                                                        <i class="fas fa-save me-2"></i>Enregistrer
                                                    </button>
                                                    <button type="submit" class="btn btn-outline-secondary" name="btn_fermer">
                                                        <i class="fas fa-times me-2"></i>Fermer
                                                    </button>
                                                </div>
                                            </div>
                                        {% else %}
                                            <div class="col-12 text-center py-4">
                                                <i class="fas fa-comments fa-3x text-muted mb-3"></i>
                                                <h5 class="text-muted">Aucun témoignage enregistré</h5>
                                                <p class="text-muted">Les témoignages apparaîtront ici une fois créés.</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        <!-- </div> -->
                    </div>
                </div>

                <!-- Onglet 5: Envoyer un email -->
                <div class="tab-pane fade" id="email" role="tabpanel">
                    <div class="container-xxl">
                        <!-- <div class="container"> -->
                            <div class="card shadow-sm">
                                <div class="card-header bg-light">
                                    <h5 class="mb-0"><i class="fas fa-envelope me-2"></i>Envoyer un email à l'élève</h5>
                                </div>
                                <div class="card-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label for="email_expediteur_id" class="form-label fw-bold">Votre adresse email</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-envelope"></i></span>
                                                <input type="email" class="form-control" id="email_expediteur_id" name="email_user"
                                                    value="{{ request.user.email }}">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label for="email_destinataire_id" class="form-label fw-bold">Email de l'élève</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-user-graduate"></i></span>
                                                <input type="email" class="form-control" id="email_destinataire_id" name="email_eleve"
                                                    value="{{ user_eleve_select.email }}">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label for="sujet_email_id" class="form-label fw-bold">Sujet de l'email</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="fas fa-tag"></i></span>
                                                <input type="text" class="form-control" id="sujet_email_id" name="sujet" value="{{ sujet|default:'' }}">
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label for="text_email_id" class="form-label fw-bold">Contenu de votre email</label>
                                            <textarea class="form-control email-editor" id="text_email_id" name="text_email" rows="6">{{ text_email|default:'' }}</textarea>
                                            <div class="form-text d-flex justify-content-between mt-1">
                                                <span>Rédigez votre message</span>
                                                <span id="emailCharCount">0 caractères</span>
                                            </div>
                                        </div>
                                        <div class="col-12 mt-4">
                                            <div class="d-flex gap-2">
                                                <button type="submit" class="btn btn-warning" name="btn_email">
                                                    <i class="fas fa-paper-plane me-2"></i>Envoyer
                                                </button>
                                                <button type="submit" class="btn btn-outline-secondary" name="btn_fermer">
                                                    <i class="fas fa-times me-2"></i>Fermer
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <!-- </div> -->
                    </div>
                </div>
            </div>
            {% endif %}
        </form>
    </div>
</div>

<!-- Back to Top -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top"><i class="bi bi-arrow-up"></i></a>
{% endblock %}

{% block javascript %}
<!-- JavaScript existant préservé -->
<script src="{% static 'js/Code_en_plus_admin_compte_eleve.js' %}"></script>


<!-- Nouveau JavaScript pour les améliorations -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialisation des tooltips Bootstrap
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });

        // Recherche d'élèves en temps réel
        const eleveSearch = document.getElementById('eleveSearch');
        const searchResults = document.getElementById('searchResults');
        const eleveResults = document.getElementById('eleveResults');

        if (eleveSearch && searchResults && eleveResults) {
            eleveSearch.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const items = eleveResults.querySelectorAll('.eleve-item');
                
                let hasResults = false;
                
                items.forEach(item => {
                    const text = item.textContent.toLowerCase();
                    if (text.includes(searchTerm)) {
                        item.style.display = 'block';
                        hasResults = true;
                    } else {
                        item.style.display = 'none';
                    }
                });
                
                searchResults.style.display = hasResults ? 'block' : 'none';
            });

            eleveSearch.addEventListener('focus', function() {
                if (this.value.length > 0) {
                    searchResults.style.display = 'block';
                }
            });

            document.addEventListener('click', function(e) {
                if (!eleveSearch.contains(e.target) && !searchResults.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
        }

        // Sélection d'un élève
        const eleveItems = document.querySelectorAll('.eleve-item');
        eleveItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const id = this.getAttribute('data-id');
                const value = this.getAttribute('data-value');
                
                document.getElementById('eleveSearch').value = value;
                document.getElementById('selected_eleve').value = id;
                if (searchResults) {
                    searchResults.style.display = 'none';
                }
                
                // Soumettre le formulaire pour charger les données de l'élève
                document.querySelector('form').submit();
            });
        });

        // Formatage du téléphone
        const phoneInputs = document.querySelectorAll('.form-control-telephone');
        phoneInputs.forEach(input => {
            input.addEventListener('input', function(e) {
                let value = e.target.value.replace(/\D/g, '');
                if (value.length > 10) value = value.substring(0, 10);
                
                let formattedValue = '';
                for (let i = 0; i < value.length; i++) {
                    if (i === 2 || i === 4 || i === 6 || i === 8) {
                        formattedValue += ' ';
                    }
                    formattedValue += value[i];
                }
                e.target.value = formattedValue;
            });
        });

        // Navigation par onglets - sauvegarde de l'onglet actif
        const eleveTabs = document.getElementById('eleveTabs');
        if (eleveTabs) {
            const tabEls = eleveTabs.querySelectorAll('button[data-bs-toggle="tab"]');
            tabEls.forEach(tab => {
                tab.addEventListener('shown.bs.tab', function(e) {
                    localStorage.setItem('activeEleveTab', e.target.getAttribute('id'));
                });
            });

            // Restaurer l'onglet actif
            const activeTab = localStorage.getItem('activeEleveTab');
            if (activeTab) {
                const tabEl = document.querySelector(`#${activeTab}`);
                if (tabEl) {
                    new bootstrap.Tab(tabEl).show();
                }
            }
        }

        
        // Animation des boutons
        const buttons = document.querySelectorAll('button[type="submit"]');
        buttons.forEach(button => {
            button.addEventListener('click', function() {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>' + this.textContent;
                // this.disabled = true;
                
                // Réactiver après 3 secondes au cas où la soumission échouerait
                setTimeout(() => {
                    this.disabled = false;
                    this.innerHTML = originalText;
                }, 3000);
            });
        });
        

        // Compteur de caractères pour l'email
        const emailTextarea = document.getElementById('text_email_id');
        const emailCharCount = document.getElementById('emailCharCount');
        
        if (emailTextarea && emailCharCount) {
            emailTextarea.addEventListener('input', function() {
                emailCharCount.textContent = this.value.length + ' caractères';
            });
            // Initialiser le compteur
            emailCharCount.textContent = emailTextarea.value.length + ' caractères';
        }

        // Redimensionnement automatique des textareas
        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = (textarea.scrollHeight) + 'px';
        }

        const textareas = document.querySelectorAll('textarea');
        textareas.forEach(textarea => {
            textarea.addEventListener('input', function() {
                adjustTextareaHeight(this);
            });
            // Ajuster initialement
            adjustTextareaHeight(textarea);
        });
    });
</script>

<style>
.admin-container {
    min-height: calc(100vh - 150px);
}

.sidebar-column {
    background-color: #f8f9fa;
    border-right: 1px solid #dee2e6;
    padding-right: 0;
}

.content-column {
    padding: 20px;
}

.card {
    border: none;
    border-radius: 12px;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.1) !important;
}

.card-header {
    border-bottom: 1px solid rgba(0,0,0,0.1);
    border-radius: 12px 12px 0 0 !important;
}

.nav-tabs .nav-link {
    border: none;
    border-bottom: 3px solid transparent;
    color: #6c757d;
    font-weight: 500;
    padding: 1rem 1.5rem;
    transition: all 0.3s ease;
}

.nav-tabs .nav-link:hover {
    border-color: #dee2e6;
    color: #0d6efd;
}

.nav-tabs .nav-link.active {
    border-bottom-color: #0d6efd;
    color: #0d6efd;
    background: transparent;
}

.form-label {
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.input-group-text {
    background-color: #f8f9fa;
    border-right: none;
}

.form-control {
    border-left: none;
    transition: all 0.3s ease;
}

.form-control:focus {
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
    border-color: #86b7fe;
}

.form-control:focus + .input-group-text {
    border-color: #86b7fe;
}

.search-results-container {
    position: absolute;
    z-index: 1000;
    width: 100%;
    max-height: 300px;
    overflow-y: auto;
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

.eleve-item {
    border: none;
    border-bottom: 1px solid #f8f9fa;
    transition: background-color 0.2s ease;
}

.eleve-item:hover {
    background-color: #f8f9fa;
}

.eleve-item:last-child {
    border-bottom: none;
}

.btn {
    border-radius: 8px;
    padding: 0.5rem 1.5rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.check-pricipal {
    width: 3rem;
    height: 1.5rem;
}

.form-switch .form-check-input {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
}

.form-switch .form-check-input:checked {
    background-color: #198754;
    border-color: #198754;
}

.testimonial-card {
    border-left: 4px solid #0d6efd;
}

.email-editor {
    min-height: 200px;
    resize: vertical;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .sidebar-column {
        border-right: none;
        border-bottom: 1px solid #dee2e6;
        margin-bottom: 20px;
    }
    
    .nav-tabs .nav-link {
        padding: 0.75rem 1rem;
        font-size: 0.9rem;
    }
    
    .card-body .row {
        margin-left: -0.5rem;
        margin-right: -0.5rem;
    }
    
    
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    animation: fadeIn 0.5s ease-out;
}

/* Loading animation */
.fa-spinner {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{% endblock %}