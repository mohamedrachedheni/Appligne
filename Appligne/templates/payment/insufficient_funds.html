<!-- templates/payment/insufficient_funds.html -->
<div class="container">
    <h2>ðŸ’¸ Fonds insuffisants pour le transfert</h2>
    
    {% if invoice %}
    <div class="alert alert-info">
        <p><strong>Facture :</strong> {{ invoice.invoice_number }}</p>
        <p><strong>Montant requis :</strong> {{ amount_needed }} â‚¬</p>
    </div>
    {% endif %}
    
    <div class="balance-info">
        <p><strong>Solde disponible :</strong> {{ available_balance }} â‚¬</p>
        <p><strong>Manquant :</strong> {{ missing_amount }} â‚¬</p>
    </div>
    
    <div class="actions">
        <!-- Bouton pour ajouter des fonds -->
        <button onclick="addFunds({{ missing_amount|floatformat:0 }})" class="btn btn-primary">
            âž• Ajouter {{ missing_amount|floatformat:0 }}â‚¬
        </button>
        
        <!-- Bouton pour rÃ©essayer (recharge la page prÃ©cÃ©dente) -->
        <button onclick="retryTransfer()" class="btn btn-success">
            ðŸ”„ RÃ©essayer le transfert
        </button>
        
        <!-- Bouton pour retourner au tableau de bord -->
        <a href="/admin/" class="btn btn-secondary">
            ðŸ“Š Tableau de bord
        </a>
    </div>
    
    <div id="result"></div>
</div>

<script>
function addFunds(amount) {
    fetch(`/payment/stripe/add-funds/?amount=${amount}`)
      .then(res => res.json())
      .then(data => {
        if (data.url) {
            window.location.href = data.url;
        }
      });
}


function retryTransfer() {
    // Retour Ã  la page prÃ©cÃ©dente ou recharge
    if (document.referrer) {
        window.location.href = document.referrer;
    } else {
        window.location.href = '/payment/transfert/create/';
    }
}
</script>

<style>
.alert-success { background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; }
.alert-danger { background: #f8d7da; color: #721c24; padding: 10px; border-radius: 5px; }
.btn { margin: 5px; padding: 10px 15px; text-decoration: none; display: inline-block; }
</style>