{% extends 'base.html' %}
{% load static %}
{% block title %} | Demande de règlement{% endblock %}

{% block content %}

<!-- Page Content -->
<div class="row justify-content-center">
    <!-- Sidebar Column -->
    <div class="col-sm-12 col-md-4 col-lg-2">
        {% include 'partials/_sidebar.html' %}
    </div>
    
    <!-- Main Content Column -->
    <div class="col-sm-12 col-md-8 col-lg-10 wow fadeInUp px-4" data-wow-delay="0.1s">
        <!-- Page Header -->
        <div class="container-xxl py-1">
            <div class="container">
                <div class="text-center wow fadeInUp" data-wow-delay="0.1s">
                    <h3 class="section-title bg-white text-center text-primary px-3">Déclarer des cours pour règlement</h3>
                </div>
                <div class="col-md-12">
                    {% include 'partials/_alerts.html' %}
                </div>
            </div>
        </div>

        <!-- Payment Request Form -->
        <form method="POST" enctype="multipart/form-data" autocomplete="off">
            {% csrf_token %}
            
            <!-- Student and Course Information Section -->
            <div class="container-xxl py-5">
                <div class="container bg-light py-5 rounded shadow-sm">
                    <div class="row g-3">
                        {% if request.user.is_authenticated %}
                            <!-- Student Information -->
                            <div class="col-md-12">
                                <div class="student-info-card p-3 mb-4 bg-white rounded">
                                    <h5 class="text-primary mb-3">Informations de l'élève</h5>
                                    <p class="mb-1"><strong>Nom :</strong> {{ mon_eleve.eleve.user.last_name }} {{ mon_eleve.eleve.user.first_name }}</p>
                                    <p class="mb-1"><strong>Téléphone :</strong> {{ mon_eleve.eleve.numero_telephone }}</p>
                                    <p class="mb-1"><strong>Adresse :</strong> {{ mon_eleve.eleve.adresse }}</p>
                                    <small class="text-muted">Dernière mise à jour : {{ mon_eleve.date_modification }}</small>
                                </div>
                            </div>

                            <!-- Courses Information -->
                            {% for mon_cours in mes_cours %}
                                <div class="col-md-12">
                                    <div class="course-header p-2 mb-2 bg-primary text-white rounded">
                                        <h6 class="mb-0 py-1">{{ mon_cours.format_cours }} - {{ mon_cours.matiere }}</h6>
                                        <small>Niveau: {{ mon_cours.niveau }} | Prix: {{ mon_cours.prix_heure }} €/h</small>
                                    </div>
                                    
                                    <!-- Sessions for each course -->
                                    <div class="sessions-container">
                                        {% for enr_horaire, enr_horaire_id  in enr_horaires %}
                                            {% if mon_cours.id == enr_horaire.cours_id %}
                                                <div class="session-card row g-2 align-items-center mb-3 p-3 bg-white rounded border">
                                                    <div class="col-lg-2">
                                                        <label class="form-label small text-muted">Date</label>
                                                        <div class="form-control-plaintext">{{ enr_horaire.date }}</div>
                                                    </div>
                                                    <div class="col-md-1">
                                                        <label class="form-label small text-muted">Début</label>
                                                        <div class="form-control-plaintext">{{ enr_horaire.debut }}</div>
                                                    </div>
                                                    <div class="col-md-1">
                                                        <label class="form-label small text-muted">Fin</label>
                                                        <div class="form-control-plaintext">{{ enr_horaire.fin }}</div>
                                                    </div>
                                                    <div class="col-md-4">
                                                        <label class="form-label small text-muted">Contenu</label>
                                                        <div class="form-control-plaintext">{{ enr_horaire.contenu }}</div>
                                                    </div>
                                                    <div class="col-lg-4">
                                                        <div class="status-section">
                                                            <label class="form-label small text-muted">Statut</label>
                                                            <div class="d-flex align-items-center">
                                                                <div class="me-2">
                                                                    <span class="badge bg-{% if enr_horaire.statut == 'Annuler' %}danger{% else %}secondary{% endif %} p-3 w-100">
                                                                        {{ enr_horaire.statut }}
                                                                    </span>
                                                                </div>
                                                                <div class="form-check form-switch d-flex align-items-center">
                                                                    <input class="form-check-input me-2 " 
                                                                        type="checkbox" 
                                                                        id="chk_{{ enr_horaire_id }}" 
                                                                        name="chk"
                                                                        value="{{ enr_horaire_id }}"
                                                                        {% if enr_horaire.payment_id or enr_horaire.demande_paiement_id or enr_horaire.statut == "Annuler" %}disabled{% endif %}
                                                                        >
                                                                    
                                                                    <label class="form-check-label" for="chk_{{ enr_horaire.id }}">
                                                                        {% if enr_horaire.payment_id %}
                                                                            <span class="badge bg-info bg-opacity-10 text-dark p-3 w-100">
                                                                                <i class="fas fa-check-circle me-1"></i> Paiement validé
                                                                            </span>
                                                                        {% elif enr_horaire.demande_paiement_id and not enr_horaire.payment_id %}
                                                                            <span class="badge bg-secondary bg-opacity-10 text-white p-3 w-100 ">
                                                                                <i class="fas fa-clock me-1"></i> En attente de règlement
                                                                            </span>
                                                                        {% elif enr_horaire.statut == "Annuler" %}
                                                                            <span class="badge bg-danger bg-opacity-10 text-dark p-3 w-100">
                                                                                <i class="fas fa-times-circle me-1"></i> Séance annulée
                                                                            </span>
                                                                        {% else %}
                                                                            <span class="badge bg-primary bg-opacity-10 text-white p-3 w-100 ">
                                                                                <i class="fas fa-edit me-1"></i> À déclarer
                                                                            </span>
                                                                        {% endif %}
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endfor %}
                            
                            <!-- Submit Button -->
                            <div class="col-12 text-end mt-4">
                                <button type="submit" class="btn btn-primary px-4 py-2" name="btn_reglement">
                                    <i class="fas fa-paper-plane me-2"></i>Envoyer la demande de règlement
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Back to Top Button -->
<a href="#" class="btn btn-lg btn-primary btn-lg-square back-to-top">
    <i class="bi bi-arrow-up"></i>
</a>

{% endblock %}

{% block javascript %}
<!-- Add any specific JavaScript here -->
{% endblock %}